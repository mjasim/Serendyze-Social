<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    .links line {
        stroke: #999;
        stroke-opacity: 0.6;
    }

    .nodes circle {
        stroke: #fff;
        stroke-width: 1.5px;
    }

    #proceedtopost:hover {
        background-color: black !important;
        color: white;
        cursor: pointer;
    }

    /* #dicetoggle:hover {
        cursor: pointer;
        opacity: 1.0
    } */

    .ui-tooltip {
        max-width: 300px !important;
        background-color: white;
        border: solid thin lightgray;
        border-radius: 10px;
    }

    text {
        font-family: sans-serif;
        font-size: 10px;
    }

    .commentText:hover {
        background-color: lightgray;
        cursor: pointer;
    }

    .serenText:hover {
        background-color: lightgray;
        cursor: pointer;
    }

    .topicbtn:hover {
        /* background-color: #ff6 !important; */
        border: solid 2px goldenrod !important;
        cursor: pointer !important;
        font-weight: bold !important;
    }

    .discbtn:hover {
        /* background-color: #ff6 !important; */
        border: solid 2px goldenrod !important;
        cursor: pointer;
        font-weight: bold !important;
    }

    .metbar:hover {
        cursor: pointer;
    }
</style>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/7.2.0/math.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

<link rel="stylesheet" href="jquery.paginate.css">

<!-- <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->

<!-- <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"> -->

<!-- <link rel="stylesheet" href="/resources/demos/style.css"> -->

<!-- <script src="https://unpkg.com/@popperjs/core@2"></script>

<script src="https://unpkg.com/tippy.js@6"></script> -->

<!-- Amazon -->

<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-0">
    <a class="navbar-brand" href="#" onclick="reload_page()" title="Refresh Page and Start Over">
        <!-- <img src="images/dice.png" width="30" height="30" alt=""> -->
        Serendyze
    </a>
    <button class="navbar-toggler py-0" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon py-0"></span>
    </button>

    <div class="collapse navbar-collapse py-0" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto py-0">
            <li class="nav-item active py-0">
                <a class="nav-link py-1" href="#" onclick="gototutorial()"
                    title="Open Tutorial in a new window">Tutorial<span class="sr-only py-0">(current)</span></a>
            </li>
            <!-- <li class="nav-item dropdown py-0">
                <a class="nav-link dropdown-toggle py-0" href="#" id="navbarDropdown" role="button"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" autofocus>
                    Dataset
                </a>
                <div class="dropdown-menu py-0" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item py-0" href="#" onclick="dataselector('amazon')">Amazon</a>
                    <a class="dropdown-item py-0" href="#" onclick="dataselector('envcanada')">EnvCanada</a>
                </div>
            </li> -->
            <li class="nav-item active py-1">
                <a class="nav-link py-0" href="#" data-toggle="modal" data-target="#aboutModal" title="About">About<span
                        class="sr-only py-0">(current)</span></a>
            </li>
            <!-- <form class="form-inline my-2 my-sm-0" onSubmit="return false;">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search"
                    id="navSearch" style="height: 25px">
                <button class="btn" type="button" onclick="render_search()"
                    style="display: inline-flex; justify-content: center; align-items: center; height: 25px; width: 10px"><i
                        class="fa fa-search" aria-hidden="true" style="color:lightgray;"></i></button>
            </form> -->
        </ul>
        <div id="proceedtopost" class="my-2 my-sm-0"
            style="background-color: white; border:solid thin black; border-radius: 20px;padding-left:10px; padding-right: 10px; display: none;"
            onclick="gotoPost()">Finalize
            Decision and
            Proceed</div>
    </div>
</nav>

<div class="modal fade bd-example-modal-lg" id="aboutModal" tabindex="-1" role="dialog"
    aria-labelledby="aboutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="aboutModalLabel">About</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Dice is a research project aimed to study how users explore short free-form text information online
                    before making a decision. If you have any question about the project, contact:
                    <address>
                        <b>Mahmood Jasim</b><br>
                        Graduate Researcher<br>
                        College of Information and Computer Sciences<br>
                        University of Massachusetts<br>
                        Amherst, MA - 01002<br>
                        Email: <a href="mailto:mjasim@cs.umass.edu">mjasim@cs.umass.edu</a><br>
                    </address>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<body onload="checkLoad()">

    <div style="display:flex; flex-direction: column; align-items: center; overflow-y: auto; overflow-x: hidden; background-color: white;">
        <div id="header" style="margin: 5px; display:flex; flex-direction: row; ">

            <div id="dicetoggle" style="margin-right:50px; visibility:hidden">
                <input type="checkbox" id="dicecheck" name="dicecheck" value="on" checked>
                <label for="dicecheck"> Show Suggestions</label>
            </div>


            <div class="w3-content">
                <div class="row">
                    <div class="col-12" id="dropdown_options" style="margin-right: 50px">
                        <select id="area" name="area">
                            <option value="">Pick a Product</option>
                            <option value="0">Koss Porta Pro On Ear Headphones with Case, Black / Silver</option>
                            <option value="1">Sony MDRV6 Studio Monitor Headphones with CCAW Voice Coil</option>
                            <option value="2">Sennheiser HD280PRO Headphones (old model)</option>
                        </select>

                        <!-- <select id="area" name="area">
                        <option value="">Pick a Discussion Topic</option>
                        <option value="0">Sustainable Design and Production</option>
                        <option value="1">Collection and Management</option>
                        <option value="2">Sustainable Lifestyle and Education</option>
                        <option value="3">Research and Innovation</option>
                        <option value="4">On the Ground Action</option>
                        <option value="5">Tell Us More</option>
                    </select> -->
                    </div>
                </div>
            </div>
            <!-- <div id="dicetoggle"
            style="width: 150px; height: 23px; background-color: green; color:white; border: solid thin black; border-radius: 2px; margin-left: 5%; text-align: center; display: none">
            Suggestion: On
        </div> -->
            <form id="searchbox" onSubmit="return false;" style="visibility: hidden;">
                <input class="form-control" type="search" placeholder="Search" aria-label="Search" id="navSearch"
                    style="height: 24px"></input>
            </form>
            <button id="searchbutton" class="btn" type="button" onclick="render_search()"
                style="display: inline-flex; justify-content: center; align-items: center; height: 24px; width: 10px; visibility: hidden;"><i
                    class="fa fa-search" aria-hidden="true" style="color:gray;"></i></button>
        </div>

        <div id="topicparent" style="display: flex; flex-direction: row; justify-content: center; align-items: center; width:100%; visibility:
        hidden; background-color: #f5f8fa; border-top: solid thin
        lightgray;">
            <div id="topicinfo" style="display: flex; flex-direction: row; justify-content: flex-start; align-items: center; width: 10%;
            text-align: center; padding-left:20px;">
                <i class="fa fa-info-circle fa-lg" style="margin-right: 5px; color:gray" title="These are most frequent word pairs that appear in the reviews. Click the words to filter
                    relevant reviews"></i>Keywords
            </div>
            <div id="topicbox"
                style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; justify-content: center; margin:5px; width: 90%;">
            </div>
        </div>

        <div id="discparent" style="display: flex; flex-direction: row; justify-content: center; align-items: center; width: 100%;
        visibility: hidden; background-color: white;">
            <div id="discinfo" style="display: flex; flex-direction: row; justify-content: flex-start; align-items: center;width: 10%;
            text-align: center; padding-left: 20px;">
                <i class="fa fa-info-circle fa-lg" style="margin-right: 5px; color:gray" title="Click on the sentiments to filter the reviews by Positive, Neutral, or Negative
                    reviews"></i>Sentiments
            </div>
            <div id="discbox" style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; justify-content: center;
            align-items: center; margin:5px; width: 90%">
            </div>
        </div>

        <div id="metparent" style="display: flex; flex-direction: row; justify-content: center; width: 100%; border-bottom: solid thin
        lightgray; visibility: hidden; background-color: #f5f8fa;">
            <div id="metinfo" style="display: flex; flex-direction: row; justify-content: flex-start; align-items: center;width: 10%;
            text-align: center; padding-left: 20px;">
                <i class="fa fa-info-circle fa-lg" style="margin-right: 5px; color:gray"
                    title="There metrics bars show how much of the data you have interacted with. Hover on the bars to know more"></i>Metrics
            </div>
            <div id="metricsbox"
                style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: flex-start; margin:5px; width:90%">
                <div style="display:flex; flex-direction: column; align-items: center; width:31%; margin-top: 5px; margin-bottom: 5px; margin-left: 1%; margin-right: 1%;">
                    <div class="metbar" id="visitback" style="border: solid 2px lightgrey; width:100%" title="This bar shows the amount of reviews you have directly interacted with. Keep interacting
                        with the reviews to increase your review Visit">
                        <div id="visitBar" style="height:24px; width:0%; background-color: #81d4fa;">
                        </div>
                    </div>
                    <div id="vistext"><i class="fa fa-square fa-sm" style="margin-right: 2px; color:#81d4fa"
                            aria-hidden="true"></i>Visit:
                        You read 0% reviews</div>
                </div>

                <div style="display:flex; flex-direction: column; align-items: center; width:31%; margin-top: 5px; margin-bottom: 5px; margin-left: 1%; margin-right: 1%;">
                    <div class="metbar" id="coverback" style="border: solid 2px lightgrey; width:100%" title="This bar shows the amount of reviews you have covered implicitly, including the reviews
                        that are very similar and redundant to the ones you have already interacted with. Keep
                        interacting with the reviews to increase your review Coverage">
                        <div id="coverageBar" style="height:24px; width:0%; background-color: #B39DDB;">
                        </div>
                    </div>
                    <div id="covtext"><i class="fa fa-square fa-sm" style="margin-right: 2px; color:#B39DDB"
                            aria-hidden="true"></i>Coverage: You know about 0% reviews
                    </div>
                </div>

                <!-- <div style="display:flex; flex-direction: column; align-items: center; width:31%; margin-top: 5px; margin-bottom: 5px; margin-left: 1%; margin-right: 1%;">
                    <div class="metbar" id="distback" style="border: solid 2px lightgrey; width:100%" title="This bar shows the proportion of review sentiments you have directly interacted with. Keep interacting with reviews with different kinds of sentiments
                    to increase your review Distribution">
                        <div id="distributionBar" style="height:24px; width:0%; background-color: #FFAB91;">
                        </div>
                    </div>
                    <div id="disttext"><i class="fa fa-square fa-sm" style="margin-right: 2px; color:#FFAB91"
                            aria-hidden="true"></i>Distribution: You read 0%
                        sentiments</div>
                </div> -->
                
                <div style="display:flex; flex-direction: column; align-items: center; width:31%; margin-top: 5px; margin-bottom: 5px; margin-left: 1%; margin-right: 1%;">
                    <div style="display: flex; flex-direction: row; align-items: center; width: 100%">
                        <div class="sentbar" id="posbar" style="border: solid 2px lightgrey;" title="This bar shows the amount of positive comments you have directly interacted with.">
                            <div id="positiveBar" style="display: flex; flex-direction: row; align-items: center; height:24px; width:0%; background-color: lightgray;"><i class="fa fa-plus" style="margin: 0px 3px 0px 3px"></i>
                            </div>
                        </div>
                        <div class="sentbar" id="neutbar" style="border: solid 2px lightgrey;" title="This bar shows the amount of neutral comments you have directly interacted with.">
                            <div id="neutralBar" style="display: flex; flex-direction: row; align-items: center; height:24px; width:0%; background-color: lightgray;"><i class="fa fa-minus" style="margin: 0px 3px 0px 3px"></i>
                            </div>
                        </div>
                        <div class="sentbar" id="negbar" style="border: solid 2px lightgrey;" title="This bar shows the amount of negative comments you have directly interacted with.">
                            <div id="negativeBar" style="display: flex; flex-direction: row; align-items: center; height:24px; width:0%; background-color: lightgray;"><i class="fa fa-circle-o" style="margin: 0px 3px 0px 3px"></i>
                            </div>
                        </div>
                    </div>
                    <div id="disttext"><i class="fa fa-square fa-sm" style="margin-right: 2px; color:#FFAB91" aria-hidden = "true"></i> Distribution: You read 0% sentiments
                    </div>
                </div>
            </div>
        </div>

        <div id="alltextbox"
            style="display:flex; flex-direction: row; flex-wrap: wrap; align-content: flex-start; justify-content: center; margin:5px; width:100%">
            <div id="textboxparent"
                style="display:flex; flex-direction: column; flex-wrap: wrap; justify-content: center; align-items: center; margin:5px; width:100%">
                <div id="textboxheader" style="display: flex; flex-direction: row;">
                    <div id="commentheader" style="font-weight:bold"></div>
                    <div id="commentloading" style="display: none;">
                        <img src="images/hg.gif" style="margin-left: 5px; margin-top:-5px; height:20px; height: 20px">
                    </div>
                </div>
                <div id="textbox" style="margin: 10px; max-width: 100%; height: 45vh; overflow-y:auto"></div>
            </div>
            <div id="serenboxparent"
                style="display:flex; flex-direction: column; flex-wrap: wrap; justify-content: center;">
                <div id="serenboxheader" style="display:flex; flex-direction: row;">
                    <div id="serenheader" style="font-weight:bold"></div>
                    <div id="serenloading" style="display: none;">
                        <img src="images/hg.gif" style="margin-left: 5px; margin-top:-5px; height:20px; height: 20px">
                    </div>
                </div>
                <div id="serenbox" style="margin: 0px; max-width: 0px; height: 0px; overflow-y:auto;"></div>
            </div>
        </div>
    </div>
</body>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="interaction_log.js"></script>
<script type="text/javascript" src="hilitor.js"></script>
<script src="jquery.paginate.js"></script>

<script>
    start_time = null
    end_time = null

    function checkLoad() {
        console.log("dice loaded")
        alert(
            "Refreshing the page will result in losing all progress. Please do not refresh the page unless you want to start over."
        )
        start_time = Date.now()
    }

    function gotoPost() {
        logInteraction('study' + ',' + 'visit' + ',' + metrics[0].visit.toString() + ',' + metrics[1].visit.toString() + ',' + metrics[2].visit.toString());
        logInteraction('study' + ',' + 'coverage' + ',' + metrics[0].coverage.toString() + ',' + metrics[1].coverage.toString() + ',' + metrics[2].coverage.toString());
        logInteraction('study' + ',' + 'Distribution' + ',' + JSON.stringify(discourses_array[0]) + ',' + JSON.stringify(discourses_array[1]) + ',' + JSON.stringify(discourses_array[2]));
        var finalize_text = orig_area_text[did]
        if (confirm("Confirm " + finalize_text + "?") == true) {
            end_time = Date.now()
            logInteraction('study' + ',' + 'totaltime' + ',' + (end_time - start_time) + 's');
            window.open('post_questionnaire.html', "_self")
        }
    }

    seren_log = {
        "seren_interact": 0,
        "seren_sent_cnt": 0,
        "seren_sim_cnt": 0,
        "seren_sent_mod": 0,
        "seren_sim_mod": 0
    }

    comment_interacted_with_this_batch = 0
    responses_received_this_batch = 0

    seren_suggest = []
    time_start = 0
    orig_area_text = []
    time_end = 0
    full_data = null;
    text_filter = "null"
    topic_filter = ""
    disc_filter = ""
    did = null
    prev_did = null
    selected_id_ngram = ""
    prev_selected_id_ngram = ""
    dc_array = []
    explored_list = []
    unexplored_list = []
    covered_list = []
    comment_id_list = []
    seren_id_list = []
    dice_trigger = 1
    for (var i = 0; i < 3; i++) {
        explored_list[i] = []
        unexplored_list[i] = []
        dc_array[i] = []
        comment_id_list[i] = []
        covered_list[i] = []
        seren_id_list[i] = []
    }

    selected_id_metric = ""
    prev_selected_id_metric = ""

    clicked_id_metric = ""
    prev_clicked_id_metric = ""

    myHilitor = ""

    discourses_array = []
    metrics = []

    for (var i = 0; i < 3; i++) {
        discourses_array[i] = {
            "Positive": 0,
            "Negative": 0,
            "Neutral": 0,
        }

        metrics[i] = {
            "coverage": 0,
            "visit": 0,
            "distribution": 0,
        }
    }

    d3.json("mat_data_amz.json", function (error, data) {
        if (error) throw error;
        full_data = JSON.parse(JSON.stringify(data));
        console.log(full_data)

        orig_area_text = ["Koss Porta Pro On Ear Headphones with Case, Black / Silver",
            "Sony MDRV6 Studio Monitor Headphones with CCAW Voice Coil",
            "Sennheiser HD280PRO Headphones (old model)",
        ]
    })

    var dropdown_div = ""
    dropdown_div += '<select id="area" name="area">' +
        '<option value="">Pick a Product</option>' +
        '<option value="0">Koss Porta Pro On Ear Headphones with Case, Black / Silver</option>' +
        '<option value="1">Sony MDRV6 Studio Monitor Headphones with CCAW Voice Coil</option>' +
        '<option value="2">Sennheiser HD280PRO Headphones (old model)</option>'

    document.getElementById("dropdown_options").innerHTML = dropdown_div

    // function dataselector(dataset) {
    //     if (dataset == "amazon") {
    //         console.log("Amazon")
    //         cleanup()

    //         d3.json("mat_data_amz.json", function (error, data) {
    //             if (error) throw error;
    //             full_data = JSON.parse(JSON.stringify(data));
    //             console.log(full_data)

    //             orig_area_text = ["Koss Porta Pro On Ear Headphones with Case, Black / Silver",
    //                 "Sony MDRV6 Studio Monitor Headphones with CCAW Voice Coil",
    //                 "Sennheiser HD280PRO Headphones (old model)",
    //                 "Sennheiser RS120 On-Ear Wireless RF Headphones with Charging Dock",
    //                 "Sony MDR7506 Professional Large Diaphragm Headphone",
    //                 "Sennheiser HD 202 II Professional Headphones (Black)",
    //                 "Sony MDREX10LP/BLK In-Ear Headphones",
    //                 "Bose QuietComfort 15 Acoustic Noise Cancelling Headphones",
    //                 "Bose QuietComfort 25 Acoustic Noise Cancelling Headphones",
    //                 "Bluedio T2s Bluetooth Headphones On Ear with Mic, 57mm Driver"
    //             ]
    //         })

    //         var dropdown_div = ""
    //         dropdown_div += '<select id="area" name="area">' +
    //             '<option value="">Pick a Product</option>' +
    //             '<option value="0">Koss Porta Pro On Ear Headphones with Case, Black / Silver</option>' +
    //             '<option value="1">Sony MDRV6 Studio Monitor Headphones with CCAW Voice Coil</option>' +
    //             '<option value="2">Sennheiser HD280PRO Headphones (old model)</option>' +
    //             '<option value="3">Sennheiser RS120 On-Ear Wireless RF Headphones with Charging Dock' +
    //             '</option>' +
    //             '<option value="4">Sony MDR7506 Professional Large Diaphragm Headphone</option>' +
    //             '<option value="5">Sennheiser HD 202 II Professional Headphones (Black)</option>' +
    //             '<option value="6">Sony MDREX10LP/BLK In-Ear Headphones</option>' +
    //             '<option value="7">Bose QuietComfort 15 Acoustic Noise Cancelling Headphones</option>' +
    //             '<option value="8">Bose QuietComfort 25 Acoustic Noise Cancelling Headphones</option>' +
    //             '<option value="9">Bluedio T2s Bluetooth Headphones On Ear with Mic, 57mm Driver' +
    //             '</option>'

    //         document.getElementById("dropdown_options").innerHTML = dropdown_div

    //     } else {
    //         console.log("EnvCanada")
    //         cleanup()

    //         d3.json("mat_data_env.json", function (error, data) {
    //             if (error) throw error;
    //             full_data = JSON.parse(JSON.stringify(data));
    //             console.log(full_data)

    //             orig_area_text = ["Pick a Discussion Topic", "Sustainable Design and Production",
    //                 "Collection and Management", "Sustainable Lifestyle and Education",
    //                 "Research and Innovation",
    //                 "On the Ground Action", "Tell Us More"
    //             ]
    //         })

    //         var dropdown_div = ""
    //         dropdown_div += '<select id="area" name="area">' +
    //             '<option value="">Pick a Discussion Topic</option>' +
    //             '<option value="0">Sustainable Design and Production</option>' +
    //             '<option value="1">Collection and Management</option>' +
    //             '<option value="2">Sustainable Lifestyle and Education</option>' +
    //             '<option value="3">Research and Innovation</option>' +
    //             '<option value="4">On the Ground Action</option>' +
    //             '<option value="5">Tell Us More</option>' +
    //             '</select>'

    //         document.getElementById("dropdown_options").innerHTML = dropdown_div
    //     }
    // }

    function cleanup() {
        seren_log = {
            "seren_interact": 0,
            "seren_sent_cnt": 0,
            "seren_sim_cnt": 0,
            "seren_sent_mod": 0,
            "seren_sim_mod": 0
        }

        seren_suggest = []
        time_start = 0
        orig_area_text = []
        time_end = 0
        full_data = null;
        text_filter = "null"
        topic_filter = ""
        disc_filter = ""
        did = null
        prev_did = null
        selected_id_ngram = ""
        prev_selected_id_ngram = ""
        dc_array = []
        explored_list = []
        unexplored_list = []
        covered_list = []
        comment_id_list = []
        seren_id_list = []
        dice_trigger = 1
        for (var i = 0; i < 30; i++) {
            explored_list[i] = []
            unexplored_list[i] = []
            dc_array[i] = []
            comment_id_list[i] = []
            seren_id_list[i] = []
            covered_list[i] = []
        }
        selected_id_metric = ""
        prev_selected_id_metric = ""
        myHilitor = ""
        discourses_array = []
        metrics = []
        for (var i = 0; i < 30; i++) {
            discourses_array[i] = {
                "Positive": 0,
                "Negative": 0,
                "Neutral": 0,
            }
            metrics[i] = {
                "coverage": 0,
                "visit": 0,
                "distribution": 0,
            }
        }

        document.getElementById("dicetoggle").style.visibility = "hidden"
        document.getElementById("topicparent").style.visibility = "hidden"
        document.getElementById("discparent").style.visibility = "hidden"
        document.getElementById("metparent").style.visibility = "hidden"
        document.getElementById("textboxheader").style.display = "none"
        document.getElementById("serenboxheader").style.display = "none"

        var myNode = document.getElementById("topicbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        var myNode = document.getElementById("discbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        var myNode = document.getElementById("textbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        var myNode = document.getElementById("serenbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }
    }

    function render_topics(discussion_id) {
        proposal_data = full_data[discussion_id]
        // console.log(proposal_data)
        var myNode = document.getElementById("topicbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        // console.log(proposal_data.ngrams)

        var sorted_ngrams = proposal_data.ngrams.sort(function (a, b) {
            return b.count - a.count
        })

        // console.log("sortedsorted", sorted_ngrams)

        for (var i in sorted_ngrams.slice(0, 8)) {
            var divbutton = document.createElement("div")
            var buttonHTML = '<div class="topicbtn" id="ngram_' + i +
                '\" style="margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px lightgray; text-align: center; width: 140px;">' +
                sorted_ngrams[i].ngram + '</div>' +
                '<div style="margin:5px; padding-left:3px; padding-right:3px; position: relative; width: 140px;">' +
                '<div class="tinybar" id=\"met_' +
                sorted_ngrams[i].ngram +
                '\" style="width: 0%; height: 24px; background-color:red; display:none; border-radius: 5px; position: absolute; top:-30px; left: 0;"></div></div>';
            divbutton.innerHTML = buttonHTML;
            myNode.appendChild(divbutton)
        }

        document.getElementById('topicparent').style.borderBottom = "solid thin lightgray"
    }

    function render_search() {
        logInteraction('click,search_' + search_filter + ',search a keyword')

        if (selected_id_ngram) {
            document.getElementById(selected_id_ngram).setAttribute("style",
                "margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px goldenrod; text-align: center; width: 140px;"
            )
        }
        if (prev_selected_id_ngram) {
            document.getElementById(prev_selected_id_ngram).setAttribute("style",
                "margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px lightgray; text-align: center; width: 140px;"
            )
        }

        if (selected_id_disc) {
            document.getElementById(selected_id_disc).setAttribute("style",
                "margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px goldenrod; text-align: center; width: 200px;"
            )
        }
        if (prev_selected_id_disc) {
            document.getElementById(prev_selected_id_disc).setAttribute("style",
                "margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px lightgray; text-align: center; width: 200px;"
            )
        }

        if (did && document.getElementById("navSearch").value.toLowerCase()) {
            var search_filter = document.getElementById("navSearch").value.toLowerCase()

            console.log(search_filter)

            var count = 0
            proposal_data = full_data[did]

            var myNode = document.getElementById("textbox");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.firstChild);
            }

            for (var i in proposal_data.comments) {
                var sent = ""
                var headertext = ""

                headertext = "Reviews with searched keyword \"" + document.getElementById("navSearch").value +
                    "\": "

                if (proposal_data.comments[i].comment.toLowerCase().includes(search_filter)) {
                    count += 1

                    divSum = document.createElement("div")

                    if (proposal_data.comments[i].discourse == "Positive") {
                        sent = '<i class="fa fa-plus"></i>'
                    } else if (proposal_data.comments[i].discourse == "Negative") {
                        sent = '<i class="fa fa-minus"></i>'
                    } else {
                        sent = '<i class="fa fa-circle-o"></i>'
                    }

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:10px; padding-right:10px; ' +
                        '\">' +
                        sent + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment + '</p> </div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #81d4fa")
                    }
                }
            }
            document.getElementById("commentheader").textContent = headertext + count

            myHilitor = new Hilitor("textbox");
            myHilitor.setMatchType("open");
            myHilitor.apply(search_filter);
        } else if (did && !document.getElementById("navSearch").value.toLowerCase()) {
            text_filter = ""
            render_text(text_filter)
        }
    }

    $(document).ready(function(){
        // $(document).tooltip();
    });

    function reload_page() {
        logInteraction('click,nav_dice_brand,reload');
        window.location.reload()
        return false
    }

    function render_discourse(discussion_id) {
        proposal_data = full_data[discussion_id]
        // console.log(proposal_data.discourses)
        var myNode = document.getElementById("discbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        for (var i in proposal_data.discourses) {

            var sent_color = "white"
            var sent_text = "black"
            var sent = ""

            if (proposal_data.discourses[i].discourse_name == "Positive") {
                sent = '<i class="fa fa-plus" style="margin-right: 5px"></i>'
            } else if (proposal_data.discourses[i].discourse_name == "Negative") {
                sent = '<i class="fa fa-minus" style="margin-right: 5px"></i>'
            } else {
                sent = '<i class="fa fa-circle-o" style="margin-right: 5px"></i>'
            }

            // console.log(proposal_data.discourses[i].discourse_name) // this works
            var divbutton = document.createElement("div")
            var buttonHTML = '<div class= "discbtn" id="discourse_' +
                i +
                '\" style="margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px lightgray; text-align: center; width: 200px; background-color: ' +
                sent_color + '; color: ' + sent_text +
                '\">' + sent +
                proposal_data.discourses[i].discourse_name + '</div>' +
                '<div style="margin:5px; padding-left:3px; padding-right:3px; position: relative; width: 200px;">' +
                '<div class="tinybar" id=\"met_' +
                proposal_data.discourses[i].discourse_name +
                '\" style="width: 0%; height: 24px; background-color:red; display:none; border-radius: 5px; position: absolute; top:-30px; left: 0;"></div></div>';
            divbutton.innerHTML = buttonHTML;
            myNode.appendChild(divbutton)
        }

        document.getElementById('discparent').style.borderBottom = "solid thin lightgray"
    }

    function render_text(text_filter) {
        
        var count = 0

        proposal_data = full_data[did]
        // console.log(proposal_data, disc_filter, topic_filter, text_filter)
        var myNode = document.getElementById("textbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        for (var i in proposal_data.comments) {

            var sent = ""
            var headertext = ""

            if (topic_filter && disc_filter) {
                headertext = disc_filter + " reviews with keyword \"" + topic_filter + "\": "

                var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");

                if ((proposal_data.comments[i].comment.toLowerCase().includes(topic_filter.split(" ")[0]
                        .toLowerCase()) && proposal_data.comments[i].comment.toLowerCase().includes(topic_filter
                        .split(
                            " ")[1]
                        .toLowerCase())) && disc_filter == proposal_data.comments[i].discourse) {

                    count += 1

                    divSum = document.createElement("div")

                    if (proposal_data.comments[i].discourse == "Positive") {
                        sent = '<i class="fa fa-plus"></i>'
                    } else if (proposal_data.comments[i].discourse == "Negative") {
                        sent = '<i class="fa fa-minus"></i>'
                    } else {
                        sent = '<i class="fa fa-circle-o"></i>'
                    }

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:10px; padding-right:10px;' +
                        '\">' +
                        sent + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment + '</p> </div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).style
                            .backgroundColor = "#81d4fa"
                    }
                }

            } else if (topic_filter && !disc_filter) {

                headertext = "Reviews with keyword \"" + topic_filter + "\": "
            
                var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");

                if (proposal_data.comments[i].comment.toLowerCase().includes(topic_filter.split(" ")[0]
                        .toLowerCase()) && proposal_data.comments[i].comment.toLowerCase().includes(topic_filter
                        .split(
                            " ")[1]
                        .toLowerCase())) {

                    count += 1

                    divSum = document.createElement("div")

                    if (proposal_data.comments[i].discourse == "Positive") {
                        sent = '<i class="fa fa-plus"></i>'
                    } else if (proposal_data.comments[i].discourse == "Negative") {
                        sent = '<i class="fa fa-minus"></i>'
                    } else {
                        sent = '<i class="fa fa-circle-o"></i>'
                    }

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:10px; padding-right:10px; ' +
                        '\">' +
                        sent + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment + '</p> </div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #81d4fa")
                    }
                }

            } else if (disc_filter && !topic_filter) {
                headertext = disc_filter + " reviews: "

                if (disc_filter == proposal_data.comments[i].discourse) {

                    count += 1

                    if (proposal_data.comments[i].discourse == "Positive") {
                        sent = '<i class="fa fa-plus"></i>'
                    } else if (proposal_data.comments[i].discourse == "Negative") {
                        sent = '<i class="fa fa-minus"></i>'
                    } else {
                        sent = '<i class="fa fa-circle-o"></i>'
                    }

                    divSum = document.createElement("div")
                   
                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:10px; padding-right:10px;' +
                        '\">' +
                        sent + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment + '</p> </div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #81d4fa")
                    }
                }

            } else if (!text_filter) {

                headertext = "Total reviews: "
                count += 1

                if (proposal_data.comments[i].discourse == "Positive") {
                    sent = '<i class="fa fa-plus"></i>'
                } else if (proposal_data.comments[i].discourse == "Negative") {
                    sent = '<i class="fa fa-minus"></i>'
                } else {
                    sent = '<i class="fa fa-circle-o"></i>'
                }

                divSum = document.createElement("div")
                var divHTML =
                    '<div style=\"margin:1px; margin-bottom: 10px; display:flex; flex-direction: row; align-items: flex-start\">' +
                    '<span ' +
                    ' style=\"padding-left:5px; padding-right:5px;' +
                    '\">' +
                    sent + '</span>' + "\xa0" +
                    '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                    proposal_data.comments[i].comment + '</p> </div>'
                divSum.innerHTML = divHTML;
                myNode.appendChild(divSum)

                if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                    console.log("here")
                    document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                        "style",
                        "background-color: #81d4fa")
                }
            }
        }

        document.getElementById("commentheader").textContent = headertext + count
    }

    function render_serenbox(data) {
        var myNode = document.getElementById("serenbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        seren_suggest = []

        // console.log(data)

        var pos = 1
        var neg = 1
        var neut = 1


        for (var i in explored_list[did]) {
            // console.log(explored_list[did][i].disc)
            if (explored_list[did][i].disc == "Positive")
                pos += 1
            else if (explored_list[did][i].disc == "Negative")
                neg += 1
            else
                neut += 1
        }

        var coeffofvar = math.std([pos, neg, neut]) / math.mean([pos, neg, neut])
        console.log("coeff", coeffofvar)

        var pos_proportion = pos / explored_list[did].length
        var neg_proportion = neg / explored_list[did].length
        var neut_proportion = neut / explored_list[did].length

        // console.log("props ->", pos_proportion, neg_proportion, neut_proportion)

        console.log(seren_log)

        var balanced_list = []
        var sent_score = 0
        var sim_score = 0
        for (var i in data[1]) {
            var prop_selector = null
            if (data[1][i].disc == "Positive")
                prop_selector = pos_proportion
            else if (data[1][i].disc == "Negative")
                prop_selector = neg_proportion
            else
                prop_selector = neut_proportion

            // console.log("prop-selector -> ", prop_selector)

            if (coeffofvar < 1) {
                if (seren_log.seren_sent_mod == 0) {
                    sent_score = 0.5 * (coeffofvar)
                } else {
                    sent_score = seren_log.seren_sent_mod * (coeffofvar)
                }
            } else {
                if (seren_log.seren_sent_mod == 0) {
                    sent_score = 0.5 * (1 - prop_selector)
                } else {
                    sent_score = seren_log.seren_sent_mod * (1 - prop_selector)
                }
            }

            if (seren_log.seren_sim_mod == 0) {
                sim_score = 0.5 * (1 - data[1][i].score)
            } else {
                sim_score = seren_log.seren_sim_mod * (1 - data[1][i].score)
            }

            // var score = 0.5 * (1 - prop_selector) + 0.5 * (1 - data[1][i].score)
            // var score = 0.5 * (coeffofvar) + 0.5 * (1 - data[1][i].score)
            // var sent_height = 0.5 * (1 - prop_selector) * 30
            var sent_height = sent_score * 50
            var sim_height = sim_score * 50

            // var trigger_sent =
            //     '<div id="seren_sent_' + data[1][i].id +
            //     '" style="flex:0 0 10px; align-self:flex-end; background-color:#FFAB91;margin-bottom:5px;' +
            //     'height:' +
            //     sent_height.toString() +
            //     'px;margin-left:3px"' + 'title="Distribution increase - ' + sent_height.toFixed(3).toString() +
            //     ' points' + '\"><img src="sent_up.png"></img></div>'
            // var trigger_sim =
            //     '<div id="seren_sim_' + data[1][i].id +
            //     '" style="flex: 0 0 10px; align-self:flex-end; background-color:#B39DDB;margin-bottom:5px;' +
            //     'height:' +
            //     sim_height.toString() +
            //     'px;margin-left:3px"' + 'title="Coverage increase - ' + sim_height.toFixed(3).toString() +
            //     ' points' + '\"><img src="sim_up.png"></img></div>'

            var sent_arrow_img = ""
            "images/sent_up.png"
            var sim_arrow_img = ""
            "images/sim_up.png"

            if (sent_height > 0 && sent_height <= 10) {
                sent_arrow_img = "images/sent_up_10.png"
            } else if (sent_height > 10 && sent_height <= 20) {
                sent_arrow_img = "images/sent_up_20.png"
            } else if (sent_height > 20 && sent_height <= 30) {
                sent_arrow_img = "images/sent_up_30.png"
            } else if (sent_height > 30) {
                sent_arrow_img = "images/sent_up_40.png"
            }

            if (sim_height > 0 && sim_height <= 10) {
                sim_arrow_img = "images/sim_up_10.png"
            } else if (sim_height > 10 &&
                sim_height <= 20) {
                sim_arrow_img = "images/sim_up_20.png"
            } else if (sim_height > 20 && sim_height <= 30) {
                sim_arrow_img = "images/sim_up_30.png"
            } else if (sim_height > 30) {
                sim_arrow_img = "images/sim_up_40.png"
            }

            var trigger_sent =
                '<img src="' + sent_arrow_img + '" id="seren_sent_' + data[1][i].id +
                '" style="margin-bottom:5px;' +
                'height:' +
                sent_height.toString() +
                'px;width: 15px; margin-left:3px"' + ' title="Distribution increase: ' + sent_height.toFixed(3)
                .toString() +
                ' points' + '\"></img>'
            var trigger_sim =
                '<img src="' + sim_arrow_img + '" id="seren_sim_' + data[1][i].id +
                '" style="margin-bottom:5px;' +
                'height:' +
                sim_height.toString() +
                'px; width: 15px; margin-left:3px"' + ' title="Coverage increase: ' + sim_height.toFixed(3)
                .toString() +
                ' points' + '\"></img>'

            balanced_list.push({
                "id": data[1][i].id,
                "text": data[1][i].text,
                "sent_score": sent_score,
                "sim_score": sim_score,
                "trigger_sent": trigger_sent,
                "trigger_sim": trigger_sim,
                "disc": data[1][i].disc
            })
        }

        var sorted_balanced_list = balanced_list.sort(function (a, b) {
            return b.score - a.score
        })

        // console.log(sorted_balanced_list)

        divSum = document.createElement("div")
        var divHTML = ''
        var sent = ''
        var idx_list = []

        var sentsent = 0
        var simsim = 0
        for (var x in sorted_balanced_list) {
            sentsent += sorted_balanced_list[x].sent_score
            simsim += sorted_balanced_list[x].sim_score
        }
        // console.log(sentsent / sorted_balanced_list.length, simsim / sorted_balanced_list.length)

        // for (var cnt = 0; cnt < 5;) {
        for (var idx = 0; idx < 5; idx++) {
            // //serendipity
            // Math.seedrandom()
            // roll = Math.floor(Math.random() * (6 - 1 + 1) + 1)
            // Math.seedrandom(roll.toString());
            // var idx = Math.floor(Math.random() * sorted_balanced_list.length)
            // if (idx_list.includes(idx)) {
            //     continue;
            // }

            // // console.log(sorted_balanced_list[idx])

            // cnt += 1
            // idx_list.push(idx)

            if (sorted_balanced_list[idx].disc == "Positive") {
                sent = '<i class="fa fa-plus"></i>'
            } else if (sorted_balanced_list[idx].disc == "Negative") {
                sent = '<i class="fa fa-minus"></i>'
            } else {
                sent = '<i class="fa fa-circle-o"></i>'
            }

            seren_suggest.push(sorted_balanced_list[idx])

            divHTML +=
                '<div style=\"margin:1px; margin-bottom:10px; display:flex; flex-direction: row; align-items: flex-start\">' +
                '<span ' +
                ' style=\"padding-left:5px; padding-right:5px;' + '\">' + sent + '</span>' + "\xa0" +
                '<p class="serenText" id="seren_comment_' +
                sorted_balanced_list[idx].id +
                '">' +
                sorted_balanced_list[idx].text + '</p></div>'
                // +
                // '<div style="display:flex; flex-direction: row; justify-content: flex-end; align-self:center; align-items:flex-end">' +
                // sorted_balanced_list[idx]
                // .trigger_sent +
                // sorted_balanced_list[idx].trigger_sim +
                // '</div>' + '</div>'
            // divSum.innerHTML = divHTML;
            // myNode.appendChild(divSum)
        }

        divHTML += '<div style="width=100%; height: 25px; border: solid thin lightgray; margin: 10px 10px 20px 10px">\xa0\xa0Suggested reviews you have visited already</div>'

        var proposal_data = full_data[did]
        for (var i in seren_id_list[did]){
            for (var j in proposal_data.comments){
                if(proposal_data.comments[j].comment_id == seren_id_list[did][i]){

                    if (proposal_data.comments[j].discourse == "Positive") {
                        sent = '<i class="fa fa-plus"></i>'
                    } else if (proposal_data.comments[j].discourse == "Negative") {
                        sent = '<i class="fa fa-minus"></i>'
                    } else {
                        sent = '<i class="fa fa-circle-o"></i>'
                    }

                     divHTML +=
                        '<div style=\"margin:1px; margin-bottom:10px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:5px; padding-right:5px;' + '\">' + sent + '</span>' + "\xa0" +
                        '<p style="background-color: #81D4FA" class="serenTextPrev" id="seren_comment_' +
                        proposal_data.comments[j].comment_id +
                        '">' +
                        proposal_data.comments[j].comment + '</div></div>'
                }
            }
        }
        
        divSum.innerHTML = divHTML;
        myNode.appendChild(divSum)

        console.log(seren_id_list[did])

    }

    function tinymove(bar_id, max_len) {
        var elem = document.getElementById(bar_id);
        var width = 0
        var id = setInterval(frame, 10);

        function frame() {
            if (width >= max_len) {
                clearInterval(id);
            } else {
                width = width + 1;
                elem.style.width = width + '%';
            }
        }
    }

    function move(bar_id, max_len) {
        var elem = document.getElementById(bar_id);
        var width = 0

        if (bar_id == "coverageBar") {
            width = metrics[did].coverage
        } else if (bar_id == "distributionBar") {
            width = metrics[did].distribution
        } else {
            width = metrics[did].visit
        }

        // console.log(width, max_len)
        var id = setInterval(frame, 10);

        function frame() {
            if (width >= max_len) {
                clearInterval(id);
            } else {
                width = width + 1;
                elem.style.width = width + '%';
                elem.innerHTML = '<b>' + ' ' + width * 1 + '%'
                '</b>';
            }

            if (bar_id == "coverageBar") {
                metrics[did].coverage = width
                document.getElementById("covtext").innerHTML =
                    '<i class="fa fa-square fa-sm" style="margin-right: 2px; color:#B39DDB" aria-hidden="true"></i>' +
                    'Coverage: You know about ' + covered_list[did].length + ' reviews' + ' (' + width * 1 + '%)';
                localStorage.setItem("coverageBar", width.toString())

            } else if (bar_id == "distributionBar") {
                metrics[did].distribution = width
                localStorage.setItem("distributionBar", width.toString())

                var proposal_data = full_data[did]
                var explored_ids = []
                for (var i in explored_list[did]) {
                    explored_ids.push(explored_list[did][i].id)
                }
                var pos = 0
                var neg = 0
                var neut = 0

                for (var i in proposal_data.comments) {
                    if (explored_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                        if (proposal_data.comments[i].discourse == "Positive") {
                            pos += 1
                        } else if (proposal_data.comments[i].discourse == "Negative") {
                            neg += 1
                        } else {
                            neut += 1
                        }
                    }
                }
                var total = pos + neg + neut
                var items = [{
                    "sent": "Positive",
                    "count": pos
                }, {
                    "sent": "Negative",
                    "count": neg
                }, {
                    "sent": "Neutral",
                    "count": neut
                }]
                var total = pos + neg + neut
                var sorted = items.sort(function (a, b) {
                    return b.count - a.count
                })

                var fgroup = ((sorted[0].count / total) - (sorted[1].count / total)) * 100

                if (fgroup > 10) {
                    document.getElementById("disttext").innerHTML =
                        '<i class="fa fa-square fa-sm" style="margin-right:2px; color:#FFAB91" aria-hidden="true"></i>' +
                        'Distribution: You read ' +
                        sorted[0]
                        .sent + ' reviews';
                } else {
                    var sgroup = ((sorted[1].count / total) - (sorted[2].count / total)) * 100
                    if (sgroup > 10) {
                        document.getElementById("disttext").innerHTML =
                            '<i class="fa fa-square fa-sm" style="margin-right: 2px; color:#FFAB91" aria-hidden="true"></i>' +
                            'Distribution: You read ' +
                            sorted[0]
                            .sent + ' and ' + sorted[1]
                            .sent + ' reviews';
                    } else {
                        document.getElementById("disttext").innerHTML =
                            '<i class="fa fa-square fa-sm" style="margin-right: 2px; color:#FFAB91" aria-hidden = "true"></i>' +
                            'Distribution: You read all kinds of reviews';
                    }
                }

                // document.getElementById("disttext").innerHTML = 'Distribution: ' + width * 1 + '%';
            } else {
                metrics[did].visit = width
                localStorage.setItem("visitBar", width.toString())
                document.getElementById("vistext").innerHTML =
                    '<i class="fa fa-square fa-xs" style="margin-right:3px; color:#81d4fa" aria-hidden="true"></i>' +
                    'Visit: You read ' + explored_list[did].length +
                    ' reviews' + ' (' + width * 1 + '%)';
            }
        }
    }

    function refresh_move(bar_id) {
        var elem = document.getElementById(bar_id);
        // elem.style.width = '0%';
        // elem.innerHTML = "";

        // console.log(metrics)

        if (bar_id == "coverageBar") {
            width = metrics[did].coverage
            document.getElementById("covtext").innerHTML =
                '<i class="fa fa-square fa-sm" style="margin-right: 2px; color:#B39DDB" aria-hidden="true"></i>' +
                'Coverage: You know about ' + width * 1 +
                '% reviews';
        } else if (bar_id == "distributionBar") {
            width = metrics[did].distribution
            document.getElementById("disttext").innerHTML =
                '<i class="fa fa-square fa-sm" style="margin-right: 2px; color:#FFAB91" aria-hidden="true"></i>' +
                'Distribution: You read ' + width * 1 +
                '% sentiments';
        } else {
            width = metrics[did].visit
            document.getElementById("vistext").innerHTML =
                '<i class="fa fa-square fa-sm" style="margin-right:3px; color:#81d4fa" aria-hidden="true"></i>' +
                'Visit: You read ' + width * 1 +
                '% reviews';
        }

        elem.style.width = width + '%';
        elem.innerHTML = '<b>' + ' ' + width * 1 + '%'
        '</b>';
    }

    function refresh_sentbar(bar_id){
        proposal_data = full_data[did].discourses
        var pos = 0;
        var neg = 0;
        var neut = 0;
        for (var i in proposal_data){
            if(proposal_data[i].discourse_name == "Positive")
                pos = proposal_data[i].count;
            else if(proposal_data[i].discourse_name == "Negative")
                neg = proposal_data[i].count;
            else
                neut = proposal_data[i].count;
        } 

        var total = pos + neg + neut;
        var read = discourses_array[did].Negative + discourses_array[did].Positive + discourses_array[did].Neutral;

        if(bar_id == "negbar"){
            document.getElementById("negbar").style.width = ((neg / total) * 100).toString() + '%';
            document.getElementById("negativeBar").style.width = Math.ceil((discourses_array[did].Negative / neg) * 100).toString() + '%';
            document.getElementById("negativeBar").innerHTML = '<i class="fa fa-minus" style="margin: 0px 3px 0px 3px"></i>' + Math.ceil((discourses_array[did].Negative / neg) * 100).toString() + '%'
        }
        if(bar_id == "posbar"){
            document.getElementById("posbar").style.width = ((pos / total) * 100).toString() + '%';
            document.getElementById("positiveBar").style.width = Math.ceil((discourses_array[did].Positive / pos) * 100).toString() + '%';
            document.getElementById("positiveBar").innerHTML = '<i class="fa fa-plus" style="margin: 0px 3px 0px 3px"></i>' + Math.ceil((discourses_array[did].Positive / pos) * 100).toString() + '%'
        }
        else{
            document.getElementById("neutbar").style.width = ((neut / total) * 100).toString() + '%';
            document.getElementById("neutralBar").style.width = Math.ceil((discourses_array[did].Neutral / neut) * 100).toString() + '%';
            document.getElementById("neutralBar").innerHTML = '<i class="fa fa-circle-o" style="margin: 0px 3px 0px 3px"></i>' + Math.ceil((discourses_array[did].Neutral / neut) * 100).toString() + '%'
        }

        var proposal_data = full_data[did]
        var explored_ids = []
        for (var i in explored_list[did]) {
            explored_ids.push(explored_list[did][i].id)
        }
        var pos = 0
        var neg = 0
        var neut = 0

        for (var i in proposal_data.comments) {
            if (explored_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                if (proposal_data.comments[i].discourse == "Positive") {
                    pos += 1
                } else if (proposal_data.comments[i].discourse == "Negative") {
                    neg += 1
                } else {
                    neut += 1
                }
            }
        }
        var total = pos + neg + neut
        var items = [{
            "sent": "Positive",
            "count": pos
        }, {
            "sent": "Negative",
            "count": neg
        }, {
            "sent": "Neutral",
            "count": neut
        }]
        var total = pos + neg + neut

        var items = [{
            "sent": "Positive",
            "count": pos
        }, {
            "sent": "Negative",
            "count": neg
        }, {
            "sent": "Neutral",
            "count": neut
        }]

        var sorted = items.sort(function (a, b) {
            return b.count - a.count
        })

        var fgroup = ((sorted[0].count / total) - (sorted[1].count / total)) * 100

        console.log("ggwp", sorted)

        if (fgroup > 10) {
            document.getElementById("disttext").innerHTML =
                '<i class="fa fa-square fa-sm" style="margin-right:2px; color:#FFAB91" aria-hidden="true"></i>' +
                'Distribution: You read ' +
                sorted[0]
                .sent + ' reviews';
        } else {
            var sgroup = ((sorted[1].count / total) - (sorted[2].count / total)) * 100
            if (sgroup > 10) {
                document.getElementById("disttext").innerHTML =
                    '<i class="fa fa-square fa-sm" style="margin-right: 2px; color:#FFAB91" aria-hidden="true"></i>' +
                    'Distribution: You read ' +
                    sorted[0]
                    .sent + ' and ' + sorted[1]
                    .sent + ' reviews';
            } else {
                document.getElementById("disttext").innerHTML =
                    '<i class="fa fa-square fa-sm" style="margin-right: 2px; color:#FFAB91" aria-hidden = "true"></i>' +
                    'Distribution: You read all kinds of reviews';
            }
        }

        // document.getElementById("disttext").innerHTML = '<i class="fa fa-square fa-sm" style="margin-right: 2px; color:#FFAB91" aria-hidden = "true"></i> Distribution: You read ' + explored_list[did].length +
        //             ' sentiments' + ' (' + metrics[did].visit * 1 + '%)';
    }

    function get_visit() {
        var cnt = 0
        for (var i in dc_array[did]) {
            if (dc_array[did][i] == 1) {
                cnt = cnt + 1
            }
        }
        // console.log((cnt / dc_array[did].length) * 100)
        move("visitBar", (cnt / dc_array[did].length) * 100);
    }

    function get_distribution() {
        var active_cnt = 0
        var perc_per_discourse = 0
        var cnt = 0
        proposal_disc = full_data[did].discourses
        // console.log(proposal_disc)
        for (var i in proposal_disc) {
            if (proposal_disc[i].count > 0) {
                active_cnt += 1
            }
        }
        active_cnt = 100 / active_cnt

        // console.log(active_cnt)

        for (var i in proposal_disc) {
            if (proposal_disc[i].count > 0) {
                perc_per_discourse += (discourses_array[did][proposal_disc[i].discourse_name] / proposal_disc[i]
                        .count) *
                    active_cnt

                // console.log(perc_per_discourse)
            }
        }
        move("distributionBar", perc_per_discourse);
    }

    function get_coverage(disc_comments) {

        // for (var i in disc_comments) {
        //     for (var j in explored_list) {
        //         if (disc_comments[i].comment != explored_list[j])
        //             unexplored_list.push(disc_comments[i].comment)
        //     }
        // }

        // console.log(explored_list[did], unexplored_list[did])

        $.ajax({
            type: "POST",
            url: "http://mjasim.pythonanywhere.com/",
            data: JSON.stringify({
                explored: explored_list[did],
                unexplored: unexplored_list[did]
            }),
            contentType: 'application/json;charset=UTF-8',
            success: function (data, status) {
                // console.log(data, status);

                var covered_ids = []

                for (var i in covered_list[did]) {
                    covered_ids.push(covered_list[did][i].id)
                }

                // console.log(covered_ids)

                for (var i in data[0]) {
                    // console.log(data[0][i].id, covered_ids)
                    if (!covered_ids.includes(data[0][i].id.toString())) {
                        covered_list[did].push({
                            "id": data[0][i].id.toString(),
                            "text": data[0][i].text
                        })
                    }
                }

                responses_received_this_batch += 1
                console.log("resrec", responses_received_this_batch)

                // console.log(explored_list[did], covered_list[did], data[0])

                move("coverageBar", ((covered_list[did].length) / disc_comments
                        .length) *
                    100);

                render_serenbox(data);

                if(comment_interacted_with_this_batch == responses_received_this_batch){
                    document.getElementById("area").disabled = false
                }
            }
        });
    }

    $(document).ready(function () {
        $(document).on('change', '#area', function () {
            var discussion_id = $("#area").val();

            if (document.getElementById("dicetoggle").style.visibility == "hidden") {
                document.getElementById("dicetoggle").style.visibility = "visible"
            }

            if (document.getElementById("textboxheader").style.display == "none") {
                document.getElementById("textboxheader").style.display = "block"
            }

            if (document.getElementById("serenboxheader").style.display == "none") {
                document.getElementById("serenboxheader").style.display = "block"
            }

            if (document.getElementById("topicparent").style.visibility == "hidden") {
                document.getElementById("topicparent").style.visibility = "visible"
            }

            if (document.getElementById("discparent").style.visibility == "hidden") {
                document.getElementById("discparent").style.visibility = "visible"
            }

            if (document.getElementById("metparent").style.visibility == "hidden") {
                document.getElementById("metparent").style.visibility = "visible"
            }

            if (document.getElementById("searchbox").style.visibility == "hidden") {
                document.getElementById("searchbox").style.visibility = "visible"
            }

            if (document.getElementById("searchbutton").style.visibility == "hidden") {
                document.getElementById("searchbutton").style.visibility = "visible"
            }

            // if (document.getElementById("paginatepage")) {
            //     if (document.getElementById("paginatepage").style.visibility == "hidden") {
            //         document.getElementById("paginatepage").style.visibility = "visible"
            //     }
            // }


            if (prev_did) {
                var area_text = $('#area option[value=' + prev_did + ']').text()
                console.log(area_text)
                $('#area option[value=' + prev_did + ']').html(orig_area_text[prev_did] +
                    ' - Visit: ' +
                    '<div style="color: blue">' + metrics[prev_did].visit + '</div>' +
                    '% Coverage: ' + '<div style="color: green">' + metrics[prev_did]
                    .coverage + '</div>' + '% Distribution: ' +
                    '<div style="color: red">' + metrics[prev_did].distribution +
                    '%' + '</div>')
            }

            render_topics(discussion_id)
            render_discourse(discussion_id)

            var myNode = document.getElementById("textbox");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.firstChild);
            }

            var myNode = document.getElementById("serenbox");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.firstChild);
            }

            prev_did = did

            did = discussion_id

            logInteraction('click,product_' + did + ',select product from dropdown')

            selected_id_ngram = ""
            prev_selected_id_ngram = ""

            selected_id_disc = ""
            prev_selected_id_disc = ""

            if (document.getElementById("proceedtopost")) {
                document.getElementById("proceedtopost").style.display = "block"
                finalize_text = orig_area_text[did].split(" ")
                console.log(finalize_text)
                document.getElementById("proceedtopost").innerHTML = "I have decided to pick " +
                    finalize_text[
                        0] + " " + finalize_text[1] + " " + finalize_text[2] +
                    "." + '\xa0\xa0\xa0' + '<i class="fa fa-arrow-right" aria-hidden="true"></i>'
            }

            comment_interacted_with_this_batch = 0
            responses_received_this_batch = 0

            topic_filter = ""
            disc_filter = ""
            text_filter = ""

            // console.log("exp on swicth", explored_list[did])
            unexplored_list[did] = [];

            for (var i in full_data[did].comments) {
                var exp_flag = false;
                for(var j in explored_list[did]){
                    if(explored_list[did][j].id == full_data[did].comments[i].comment_id){
                        exp_flag = true;
                    }
                }

                if(!exp_flag){
                    unexplored_list[did].push({
                        "id": full_data[did].comments[i].comment_id,
                        "text": full_data[did].comments[i].comment,
                        "disc": full_data[did].comments[i].discourse
                    })
                }
            }

            if (dc_array[did].length < 1) {
                dc_array[did] = new Array(full_data[did].comments.length)
            }

            // console.log("unexp on switch", unexplored_list[did])

            refresh_sentbar("negbar");
            refresh_sentbar("neutbar");
            refresh_sentbar("posbar");

            refresh_move("coverageBar")
            // refresh_move("distributionBar")
            refresh_move("visitBar")

            render_text(text_filter)

            console.log("dt", dice_trigger)
            if (dice_trigger == 1) {
                dice_trigger = 0
                dice_toggle()
            }
        });
    });

    $(document).on('click', '.topicbtn', function () {
        // console.log($(this)[0].innerText)
        topic_filter = $(this)[0].innerText

        if (clicked_id_metric) {
            document.getElementById(clicked_id_metric).setAttribute("style",
                "border: solid 2px lightgray; width:100%")

            clicked_id_metric = ""
            prev_clicked_id_metric = ""
        }

        selected_id_ngram = $(this)[0].id

        console.log(selected_id_ngram, prev_selected_id_ngram, selected_id_disc, prev_selected_id_disc)

        if (prev_selected_id_ngram == selected_id_ngram) {
            logInteraction('click,ngram_' + topic_filter + ',deselect an ngram')
            document.getElementById(selected_id_ngram).setAttribute("style",
                "margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px lightgray; text-align: center; width: 140px;"
            )
            selected_id_ngram = ""
            prev_selected_id_ngram = ""
            topic_filter = ""
            if (selected_id_disc) {
                console.log("discsdics - ", $("#" + selected_id_disc)[0].innerText)
                render_text($("#" + selected_id_disc)[0].innerText)
            } else {
                render_text("")
            }
        } else {
            logInteraction('click,ngram_' + topic_filter + ',select an ngram')
            document.getElementById(selected_id_ngram).setAttribute("style",
                "margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px goldenrod; text-align: center; width: 140px;"
            )
            if (prev_selected_id_ngram) {
                document.getElementById(prev_selected_id_ngram).setAttribute("style",
                    "margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px lightgray; text-align: center; width: 140px;"
                )
            }
            prev_selected_id_ngram = selected_id_ngram
            console.log($(this)[0].innerText)
            render_text($(this)[0].innerText)

            myHilitor = new Hilitor("textbox");
            myHilitor.setMatchType("open");
            myHilitor.apply(topic_filter);
        }

        $('#textbox').animate({
            scrollTop: "0"
        }, 1000);

    });

    $(document).on('click', '.discbtn', function () {
        console.log($(this)[0].innerText)
        disc_filter = $(this)[0].innerText
        console.log("click", disc_filter)

        if (clicked_id_metric) {
            document.getElementById(clicked_id_metric).setAttribute("style",
                "border: solid 2px lightgray; width:100%")

            clicked_id_metric = ""
            prev_clicked_id_metric = ""
        }

        var sent_color = "white"
        var sent_text = "black"

        selected_id_disc = $(this)[0].id

        console.log(selected_id_disc, prev_selected_id_disc)

        if (prev_selected_id_disc == selected_id_disc) {
            logInteraction('click,sentiment_' + disc_filter + ',deselect a sentiment')
            var styletext =
                'margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px lightgray; text-align: center; width: 200px; background-color: ' +
                sent_color + '; color: ' + sent_text;
            document.getElementById(selected_id_disc).setAttribute("style", styletext)
            selected_id_disc = ""
            prev_selected_id_disc = ""

            disc_filter = ""
            if (selected_id_ngram) {
                render_text($("#" + selected_id_ngram)[0].innerText)
            } else {
                render_text("")
            }

            if (topic_filter) {
                myHilitor = new Hilitor("textbox");
                myHilitor.setMatchType("open");
                myHilitor.apply(topic_filter);
            }

        } else {
            logInteraction('click,sentiment_' + disc_filter + ',select a sentiment')
            var styletext =
                'margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px goldenrod; text-align: center; width: 200px; background-color: ' +
                sent_color + '; color: ' + sent_text;
            document.getElementById(selected_id_disc).setAttribute("style", styletext)

            if (prev_selected_id_disc) {

                // var sent_color = "lightgray"
                // var sent_text = "black"
                // if (prev_selected_id_disc == "discourse_0") {
                //     sent_color = "white"
                // } else if (prev_selected_id_disc == "discourse_2") {
                //     sent_color = "black"
                //     sent_text = "white"
                // }

                var styletext =
                    'margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px lightgray; text-align: center; width: 200px; background-color: ' +
                    sent_color + '; color: ' + sent_text;
                document.getElementById(prev_selected_id_disc).setAttribute("style", styletext)
            }

            prev_selected_id_disc = selected_id_disc
            render_text($(this)[0].innerText)
            console.log($(this)[0].innerText)

            if (topic_filter) {
                myHilitor = new Hilitor("textbox");
                myHilitor.setMatchType("open");
                myHilitor.apply(topic_filter);
            }
        }

        $('#textbox').animate({
            scrollTop: "0"
        }, 1000);

    });

    function comment_interact(id, textType) {
        var text = ""
        var disc = ""
        var discbar = ""

        comment_interacted_with_this_batch += 1
        console.log("cominter", comment_interacted_with_this_batch)

        document.getElementById("area").disabled = true;

        // console.log("inside comment intr --", id)

        var covered_ids = []
        for (var i in covered_list[did]) {
            covered_ids.push(covered_list[did][i].id)
        }

        for (var i in full_data[did].comments) {
            if (full_data[did].comments[i].comment_id.toString() == id) {
                text = full_data[did].comments[i].comment
                disc = full_data[did].comments[i].discourse

                if(disc == "Positive") discbar = "posbar"
                else if(disc == "Negative") discbar = "negbar"
                else discbar = "neutbar"

                // console.log(text)
                if (!dc_array[did][i]) {
                    dc_array[did][i] = 1
                    discourses_array[did][full_data[did].comments[i].discourse] += 1
                    comment_id_list[did].push(full_data[did].comments[i].comment_id)

                    if(textType == "serenText"){
                        seren_id_list[did].unshift(full_data[did].comments[i].comment_id)
                    }

                    explored_list[did].push({
                        "id": id,
                        "text": text,
                        "disc": disc
                    })

                    if (!covered_ids.includes(id)) {
                        covered_list[did].push({
                            "id": id,
                            "text": text,
                            "disc": disc
                        })
                    }
                }
                // comment_id_list[did].push(full_data[did].comments[i].comment_id)
                if (document.getElementById("comment_" + full_data[did].comments[i].comment_id)) {
                    document.getElementById("comment_" + full_data[did].comments[i].comment_id).setAttribute(
                        "style",
                        "background-color: #81d4fa")
                }
            }
        }

        for (var i in unexplored_list[did]) {
            if (unexplored_list[did][i].text == text) {
                unexplored_list[did].splice(i, 1)
            }
        }

        console.log(discourses_array[did])
        // get_distribution()
        refresh_sentbar(discbar)
        get_coverage(full_data[did].comments)
        get_visit()
    }

    function isScrolledIntoView(elem) {
        var docViewTop = $('#textbox').scrollTop();
        var docViewBottom = docViewTop + $('#textbox').height();

        var elemTop = $(elem).offset().top;
        var elemBottom = elemTop + $(elem).height();

        return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    }

    // function do_pagination() {

    //     if (document.getElementById("paginatepage")) {
    //         var myNode = document.getElementById("paginatepage");
    //         while (myNode.firstChild) {
    //             myNode.removeChild(myNode.firstChild);
    //         }

    //         $('#textbox').unbind().removeData();
    //     }

    //     $('#textbox').paginate({
    //         scope: $('div'), // targets all div elements
    //         autoScroll: true,
    //         perPage: 100
    //     })

    //     $('#textbox').animate({
    //         scrollTop: "0"
    //     }, 1000)
    // }

    $(document).on('click', '.commentText', function () {

        // console.log(dice_trigger)
        if (dice_trigger == 1) {
            document.getElementById("serenloading").style.display = "block"
            setTimeout(function () {
                document.getElementById("serenloading").style.display = "none"
            }, 4000)
        }
        logInteraction('click,comment_' + $(this)[0].id.substring(8) + ',interact with a comment')
        comment_interact($(this)[0].id.substring(8), "commentText")
        // document.getElementById("timing").innerText = " clicked - " + $(this)[0].innerText
    });

    $(document).on('click', '.serenText', function () {

        id = $(this)[0].id
        document.getElementById(id).style.backgroundColor = "#81d4fa"

        console.log("ss", seren_suggest)

        seren_log.seren_interact += 1
        for (var i in seren_suggest) {
            if (seren_suggest[i].id == id.substring(14)) {

                console.log("changing seren log", seren_suggest[i].id)

                if (seren_suggest[i].sent_score > seren_suggest[i].sim_score) {
                    seren_log.seren_sent_cnt += 1
                } else {
                    seren_log.seren_sim_cnt += 1
                }
                seren_log.seren_sent_mod = 1 - (seren_log.seren_sent_cnt / seren_log.seren_interact)
                seren_log.seren_sim_mod = 1 - (seren_log.seren_sim_cnt / seren_log.seren_interact)
            }
        }

        if (dice_trigger == 1) {
            document.getElementById("serenloading").style.display = "block"
            setTimeout(function () {
                document.getElementById("serenloading").style.display = "none"
            }, 4000)
        }

        logInteraction('click,serencomment_' + $(this)[0].id.substring(14) +
            ',interact with a suggested comment')
        comment_interact($(this)[0].id.substring(14), "serenText")
    });

    $(document).on('mouseover', '.commentText', function () {
        time_start = Date.now();
        var delay = ($(this)[0].innerText.split(" ").length / 15) > 4 ? 4000 : ($(this)[0].innerText.split(" ").length / 15) * 1000
        if(!document.getElementById($(this)[0].id).style.backgroundColor){
            document.getElementById("commentloading").style.display = "block"
            setTimeout(function () {
                document.getElementById("commentloading").style.display = "none"
            }, delay)
        }
        // console.log($(this)[0].innerText, delay)
    });

    $(document).on('mouseover', '.serenText', function () {
        time_start = Date.now();
        var delay = ($(this)[0].innerText.split(" ").length / 15) > 4 ? 4000 : ($(this)[0].innerText.split(" ").length / 15) * 1000
        if(!document.getElementById($(this)[0].id).style.backgroundColor){
            document.getElementById("commentloading").style.display = "block"
            setTimeout(function () {
                document.getElementById("commentloading").style.display = "none"
            }, delay)
        }
        // console.log($(this)[0].innerText, start)
    });

    $(document).on('mouseout', '.commentText', function () {
        document.getElementById("commentloading").style.display = "none"
        time_end = Date.now();
        var elapsed_time = ((time_end - time_start) / 1000)
        // console.log("etime", elapsed_time)
        var delay = $(this)[0].innerText.split(" ").length / 15
        // console.log("delay", delay)
        if (this.className == 'commentText' && (elapsed_time > delay || elapsed_time > 4)) {
            if (dice_trigger == 1) {
                document.getElementById("serenloading").style.display = "block"
                setTimeout(function () {
                    document.getElementById("serenloading").style.display = "none"
                }, 4000)
            }

            logInteraction('hover,comment_' + $(this)[0].id.substring(8) + ',interact with a comment')
            comment_interact($(this)[0].id.substring(8), "commentText")
        }
    });

    $(document).on('mouseout', '.serenText', function () {
        document.getElementById("commentloading").style.display = "none"
        time_end = Date.now();
        var elapsed_time = ((time_end - time_start) / 1000)
        // console.log(elapsed_time, $(this)[0].innerText)
        var delay = $(this)[0].innerText.split(" ").length / 15
        if (this.className == 'serenText' && (elapsed_time > delay || elapsed_time > 4)) {

            id = $(this)[0].id
            document.getElementById(id).setAttribute(
                "style",
                "background-color: #81d4fa")

            if (dice_trigger == 1) {
                document.getElementById("serenloading").style.display = "block"
                setTimeout(function () {
                    document.getElementById("serenloading").style.display = "none"
                }, 4000)
            }

            logInteraction('hover,comment_' + $(this)[0].id.substring(8) +
                ',interact with a suggested comment')
            comment_interact($(this)[0].id.substring(14), "serenText")
        }
        // document.getElementById("timing").innerText = "hovered " + elapsed_time + " s over " + $(this)[
        // 0]
        // .innerText
    });

    // $(document).on('mousemove', function () {
    //     document.getElementById("coordinate").innerText = event.pageX + ", " + event.pageY
    // });

    function random_seren() {
        var random_idx = []
        // Math.seedrandom(); // seeding
        for (var cnt = 0; cnt < 5;) {
            var idx = Math.floor(Math.random() * full_data[did].comments.length)
            if (!random_idx.includes(idx)) {
                cnt += 1
                random_idx.push(idx)
            }
        }

        // console.log(random_idx)

        var myNode = document.getElementById("serenbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        proposal_data = full_data[did]
        divSum = document.createElement("div")
        var divHTML = ''
        for (var i = 0; i < 5; i++) {
            if (proposal_data.comments[random_idx[i]].discourse == "Positive") {
                sent = '<i class="fa fa-plus" style="margin-right:5px"></i>'
            } else if (proposal_data.comments[random_idx[i]].discourse == "Negative") {
                sent = '<i class="fa fa-minus"></i>'
            } else {
                sent = '<i class="fa fa-circle-o"></i>'
            }

            divHTML +=
                '<div style=\"margin:1px; margin-bottom:10px; display:flex; flex-direction: row; align-items: flex-start\">' +
                '<span ' +
                ' style=\"padding-left:5px; padding-right:5px;' + '\">' + sent + '</span>' + "\xa0" +
                '<div class="serenText" id="seren_comment_' + proposal_data.comments[random_idx[i]].comment_id +
                '">' +
                proposal_data.comments[random_idx[i]].comment + '</div>' +
                '</div>'
            divSum.innerHTML = divHTML;
            myNode.appendChild(divSum)
        }

    }

    function prev_seren() {

        // console.log("in prev", unexplored_list)

        var random_idx = []
        // Math.seedrandom(); // seeding
        for (var cnt = 0; cnt < 5;) {
            var idx = Math.floor(Math.random() * unexplored_list[did].length)
            if (!random_idx.includes(idx) || !seren_id_list.includes(idx)) {
                cnt += 1
                random_idx.push(idx)
            }
        }

        console.log("prev_seren", unexplored_list)

        var myNode = document.getElementById("serenbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        proposal_data = full_data[did]
        divSum = document.createElement("div")
        var divHTML = ''
        for (var i = 0; i < 5; i++) {
            if (proposal_data.comments[random_idx[i]].discourse == "Positive") {
                sent = '<i class="fa fa-plus" style="margin-right:5px"></i>'
            } else if (proposal_data.comments[random_idx[i]].discourse == "Negative") {
                sent = '<i class="fa fa-minus"></i>'
            } else {
                sent = '<i class="fa fa-circle-o"></i>'
            }

            divHTML +=
                '<div style=\"margin:1px; margin-bottom:10px; display:flex; flex-direction: row; align-items: flex-start\">' +
                '<span ' +
                ' style=\"padding-left:5px; padding-right:5px;' + '\">' + sent + '</span>' + "\xa0" +
                '<div class="serenText" id="seren_comment_' + proposal_data.comments[random_idx[i]].comment_id +
                '">' +
                proposal_data.comments[random_idx[i]].comment + '</div>' +
                '</div>'
        }

        divHTML += '<div style="width=100%; height: 20px; border-top: solid thin gray"></div>'

        var proposal_data = full_data[did]
        for (var i in seren_id_list[did]){
            for (var j in proposal_data.comments){
                if(proposal_data.comments[j].comment_id == seren_id_list[did][i]){
                     divHTML +=
                        '<div style=\"margin:1px; margin-bottom:10px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:5px; padding-right:5px;' + '\">' + sent + '</span>' + "\xa0" +
                        '<p style="background-color: #81D4FA" class="serenTextPrev" id="seren_comment_' +
                        proposal_data.comments[j].comment_id +
                        '">' +
                        proposal_data.comments[j].comment + '</div></div>'
                }
            }
        }

        divSum.innerHTML = divHTML;
        myNode.appendChild(divSum)

    }
    
    function dice_toggle() {
        if (dice_trigger == 0) {
            // logInteraction('click,dice,get suggested comments')

            if (!document.getElementById("serenbox").hasChildNodes() && explored_list[did].length == 0) {
                random_seren()
            }
            else{
                prev_seren()
            }

            dice_trigger = 1
            document.getElementById("serenboxparent").setAttribute("style",
                "display:flex; flex-direction: row; flex-wrap: wrap; justify-content: center; align-items: center; margin: 5px; max-width: 47%; height: 55vh;"
            )

            document.getElementById("serenbox").setAttribute("style",
                "margin: 10px; max-width: 100%; height: 45vh; overflow-y:auto;")

            document.getElementById("textboxparent").setAttribute("style",
                "display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; justify-content: center; margin: 5px; max-width: 47%; height: 55vh;"
            )

            document.getElementById("textboxheader").setAttribute("style",
                "display:flex; flex-direction: row; width: 95%; border: solid thin lightgray"
            )

            document.getElementById("serenboxheader").setAttribute("style",
                "display:flex; flex-direction: row; width: 95%; border: solid thin lightgray"
            )

            document.getElementById("serenheader").textContent = '\xa0\xa0 Suggested reviews that You may find useful:'

            // document.getElementById("dicetoggle").setAttribute("style",
            //     "width: 150px; height: 23px; background-color: green; color:white; border: solid thin black; border-radius: 2px; margin-left: 5%; text-align: center;"
            // )

            // document.getElementById("dicetoggle").textContent = "Suggestion: On"

            // do_pagination()

        } else if (dice_trigger == 1) {
            // logInteraction('click,dice,remove suggested comments')
            dice_trigger = 0

            // document.getElementById("serenboxparent").setAttribute("style",
            //     "margin: 0px; width: 0px; height: 0px;")

            // document.getElementById("serenbox").setAttribute("style",
            //     "margin: 0px; width: 0px; height: 0px; overflow-y:auto")

            // document.getElementById("serenboxheader").setAttribute("style",
            //     "display:flex; flex-direction: row; width: 0px;"
            // )

            document.getElementById("serenboxparent").style.display = "none";

            document.getElementById("serenheader").textContent = ''

            document.getElementById("textboxparent").setAttribute("style",
                "display:flex; flex-direction: column; flex-wrap: wrap; justify-content: center; align-items: center; margin:5px;"
            )
            document.getElementById("textbox").setAttribute("style",
                "margin: 5px; max-width: 95%; height: 45vh; overflow-y:auto"
            )

            // document.getElementById("dicetoggle").setAttribute("style",
            //     "width: 150px; height: 23px; background-color: red; color:white; border: solid thin black; border-radius: 2px; margin-left: 5%; text-align: center;"
            // )

            // document.getElementById("dicetoggle").textContent = "Suggestion: Off"
        }

        // <div id="alltextbox" style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; margin:5px">
        //     <div id="textboxparent"
        //         style="display:flex; flex-direction: column; flex-wrap: wrap; align-items: center; margin:5px">
        //         <div id="textbox" style="margin: 10px; max-width: 90%; height: 45vh; overflow-y:auto"></div>
        //     </div>
        //     <div id="serenbox" style="margin: 0px; max-width: 0px; height: 0px; overflow-y:auto;"></div>
        // </div>
    }

    // $(document).on('click', "#dicetoggle", function () {
    //     dice_toggle()
    // });

    $(document).ready(function () {
        $('input[type="checkbox"]').click(function () {
            if ($(this).is(":checked")) {
                console.log("checked")
                logInteraction('click,dice,get suggested comments')
                dice_toggle()
            } else if ($(this).is(":not(:checked)")) {
                console.log("unchecked")
                logInteraction('click,dice,remove suggested comments')
                dice_toggle()
            }
        });
    });

    $('#textbox').on('scroll', function () {
        var x = document.getElementById("textbox").childNodes

        var ids = $('#textbox .commentText').map(function () {
            return $(this).attr('id');
        }).get();
        for (var i in ids) {
            if ((isScrolledIntoView("#" + ids[i]))) {
                // console.log(ids[i])
            }
        }
    });


    function calc_tiny_visit(category, tag, totalcount) {
        var proposal_data = full_data[did]
        var explored_ids = []
        var met_count = 0

        // console.log(category, tag, totalcount)

        for (var i in explored_list[did]) {
            explored_ids.push(explored_list[did][i].id)
        }

        if (category == "ngram") {
            for (var i in proposal_data.comments) {
                if (explored_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                    if ((proposal_data.comments[i].comment.toLowerCase().includes(tag.split(" ")[0]) &&
                            proposal_data.comments[i].comment.toLowerCase().includes(tag.split(" ")[1]))) {
                        met_count += 1
                    }
                }
            }
            // console.log(met_count)
        } else if (category == "discourse") {
            for (var i in proposal_data.comments) {
                if (explored_ids.includes(proposal_data.comments[i].comment_id.toString()) && proposal_data
                    .comments[i]
                    .discourse ==
                    tag) {
                    met_count += 1
                }
            }
        }

        // console.log(category, tag, met_count, totalcount)
        return ((met_count / totalcount) * 100)
    }

    function calc_tiny_cover(category, tag, totalcount) {
        var proposal_data = full_data[did]
        var covered_ids = []
        var met_count = 0

        // console.log(category, tag, totalcount)

        for (var i in covered_list[did]) {
            covered_ids.push(covered_list[did][i].id)
        }

        if (category == "ngram") {
            for (var i in proposal_data.comments) {
                if (covered_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                    if ((proposal_data.comments[i].comment.toLowerCase().includes(tag.split(" ")[0]) &&
                            proposal_data.comments[i].comment.toLowerCase().includes(tag.split(" ")[1]))) {
                        met_count += 1
                    }
                }
            }
            // console.log(met_count)
        } else if (category == "discourse") {
            for (var i in proposal_data.comments) {
                if (covered_ids.includes(proposal_data.comments[i].comment_id.toString()) && proposal_data
                    .comments[i]
                    .discourse == tag) {
                    met_count += 1
                }
            }
        }

        // console.log(tag, met_count, totalcount)
        return ((met_count / totalcount) * 100)
    }

    function calc_tiny_dist(category, tag, totalcount) {
        var proposal_data = full_data[did]
        var explored_ids = []
        var pos = 0
        var neg = 0
        var neut = 0
        var tot_pos = 0
        var tot_neg = 0
        var tot_neut = 0
        var met_count = 0
        var met_return = 0

        var active_cnt = 0
        var perc_per_discourse = 0
        var cnt = 0
        proposal_disc = full_data[did].discourses
        for (var i in proposal_disc) {
            if (proposal_disc[i].count > 0) {
                active_cnt += 1
            }
        }
        active_cnt = 100 / active_cnt

        for (var i in proposal_data.comments) {
            if ((proposal_data.comments[i].comment.toLowerCase().includes(tag.split(" ")[0]) &&
                    proposal_data.comments[i].comment.toLowerCase().includes(tag.split(" ")[1]))) {
                // console.log("here")
                if (proposal_data.comments[i].discourse == "Positive") {
                    tot_pos += 1
                } else if (proposal_data.comments[i].discourse == "Negative") {
                    tot_neg += 1
                } else {
                    tot_neut += 1
                }
            }
        }

        if (tot_pos == 0) {
            tot_pos = 1
        }
        if (tot_neg == 0) {
            tot_neg = 1
        }
        if (tot_neut == 0) {
            tot_neut = 1
        }

        // console.log(tag, tot_pos, tot_neg, tot_neut)

        for (var i in explored_list[did]) {
            explored_ids.push(explored_list[did][i].id)
        }

        if (category == "ngram") {
            for (var i in proposal_data.comments) {
                if (explored_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                    // console.log("found explored")
                    if ((proposal_data.comments[i].comment.toLowerCase().includes(tag.split(" ")[0]) &&
                            proposal_data.comments[i].comment.toLowerCase().includes(tag.split(" ")[1]))) {
                        if (proposal_data.comments[i].discourse == "Positive") {
                            pos += 1
                        } else if (proposal_data.comments[i].discourse == "Negative") {
                            neg += 1
                        } else {
                            neut += 1
                        }
                    }
                }
            }

            met_return = ((pos / tot_pos) + (neg / tot_neg) + (neut / tot_neut)) * active_cnt

        } else if (category == "discourse") {
            for (var i in proposal_data.comments) {
                if (explored_ids.includes(proposal_data.comments[i].comment_id.toString()) && proposal_data
                    .comments[i]
                    .discourse ==
                    tag) {
                    met_count += 1
                }
            }
            met_return = ((met_count / totalcount) * 100)
        }
        console.log(met_return)
        return met_return
    }

    function gototutorial() {
        window.open('tutorial.html', "_blank")
    }

    $(document).on('mouseover', '.metbar', function () {

        if (did) {
            var x_array = document.getElementsByClassName("tinybar")
            var y_array = document.getElementsByClassName("topicbtn")
            var z_array = document.getElementsByClassName("discbtn")

            var tinycolor = ""
            var id = $(this)[0].id
            selected_id_metric = id

            logInteraction('hover,bar_' + id + ',hovered on metric bar')

            document.getElementById(selected_id_metric).setAttribute("style",
                "border: solid 2px goldenrod; width:100%")

            proposal_data = full_data[did]

            var ngram_list = []

            for (var i in proposal_data.ngrams) {
                if(i > 7) break;
                ngram_list.push(proposal_data.ngrams[i].ngram)
            }

            for (var i in ngram_list) {
                var totalcount = 0
                for (var j in proposal_data.comments) {

                    var tokens = proposal_data.comments[j].comment.toLowerCase().split(" ");

                    if (proposal_data.comments[j].comment.toLowerCase().includes(ngram_list[i].split(" ")[0]
                            .toLowerCase()) && proposal_data.comments[j].comment.toLowerCase().includes(
                            ngram_list[i].split(" ")[1].toLowerCase())) {
                        totalcount += 1
                    }
                }
                // IF VISIT
                if (id == "visitback") {
                    // tinycolor = "#81d4fa"

                    tinycolor = "rgba(129, 212, 250, 0.7)"
                    for (var j = 0; j < 11; j++) {
                        x_array[j].style.backgroundColor = tinycolor
                        x_array[j].style.display = "block"
                    }

                    for (var j = 0; j < 8; j++) {
                        // y_array[j].style.opacity = "0.7"
                        y_array[j].style.fontWeight = "bold"
                    }

                    for (var j = 0; j < 3; j++) {
                        // z_array[j].style.opacity = "0.7"
                        z_array[j].style.fontWeight = "bold"
                    }

                    var met_width = calc_tiny_visit("ngram", proposal_data.ngrams[i].ngram,
                        totalcount)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.ngrams[i].ngram, met_width)
                } else if (id == "coverback") {
                    // tinycolor = "#B39DDB"
                    tinycolor = "rgba(179, 157, 209, 0.7)"
                    for (var j = 0; j < 11; j++) {
                        x_array[j].style.backgroundColor = tinycolor
                        x_array[j].style.display = "block"
                    }

                    for (var j = 0; j < 8; j++) {
                        // y_array[j].style.opacity = "0.7"
                        y_array[j].style.fontWeight = "bold"
                    }

                    for (var j = 0; j < 3; j++) {
                        // z_array[j].style.opacity = "0.7"
                        z_array[j].style.fontWeight = "bold"
                    }

                    var met_width = calc_tiny_cover("ngram",
                        proposal_data.ngrams[i].ngram, totalcount)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.ngrams[i].ngram, met_width)
                } else if (id == "distback") {
                    // tinycolor = "#FFAB91"
                    tinycolor = "rgba(255, 171, 145, 0.7)"
                    for (var j = 0; j < 11; j++) {
                        x_array[j].style.backgroundColor = tinycolor
                        x_array[j].style.display = "block"
                    }

                    for (var j = 0; j < 8; j++) {
                        // y_array[j].style.opacity = "0.7"
                        y_array[j].style.fontWeight = "bold"
                    }

                    for (var j = 0; j < 3; j++) {
                        // z_array[j].style.opacity = "0.7"
                        z_array[j].style.fontWeight = "bold"
                    }

                    var met_width = calc_tiny_dist("ngram",
                        proposal_data.ngrams[i].ngram, totalcount)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.ngrams[i].ngram, met_width)
                }
            }

            for (var i in proposal_data.discourses) {
                // IF VISIT
                if (id == "visitback") {
                    var met_width = calc_tiny_visit("discourse", proposal_data.discourses[i]
                        .discourse_name,
                        proposal_data.discourses[i].count)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.discourses[i].discourse_name, met_width)
                } else if (id == "coverback") {
                    var met_width = calc_tiny_cover("discourse", proposal_data.discourses[i]
                        .discourse_name,
                        proposal_data.discourses[i].count)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.discourses[i].discourse_name, met_width)
                } else if (id == "distback") {
                    var met_width = calc_tiny_dist("discourse", proposal_data.discourses[i]
                        .discourse_name,
                        proposal_data.discourses[i].count)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.discourses[i].discourse_name, met_width)
                }
            }
        }
    });

    $(document).on('mouseout', '.metbar', function () {
        if (did) {
            var x_array = document.getElementsByClassName("tinybar")
            var y_array = document.getElementsByClassName("topicbtn")
            var z_array = document.getElementsByClassName("discbtn")

            var tinycolor = ""
            var id = $(this)[0].id
            selected_id_metric = id

            if (selected_id_metric != clicked_id_metric) {
                document.getElementById(selected_id_metric).setAttribute("style",
                    "border: solid 2px lightgray; width:100%")
            }

            if (explored_list[did].length == 0) {
                document.getElementById(selected_id_metric).setAttribute("style",
                    "border: solid 2px lightgray; width:100%")
            }

            for (var i = 0; i < 11; i++) {
                x_array[i].style.backgroundColor = tinycolor
                x_array[i].style.display = "none"
            }
            for (var j = 0; j < 8; j++) { //
                // y_array[j].style.opacity = "0.7"
                y_array[j].style.fontWeight = "normal"
            }
            for (var
                    j = 0; j < 3; j++) { // z_array[j].style.opacity="0.7"
                z_array[j].style.fontWeight = "normal"
            }
        }
    });

    $(document).on('click', '.metbar', function () {
        if (did) {
            var id = $(this)[0].id
            clicked_id_metric = id

            logInteraction('click,bar_' + id + ',clicked on metric bar')

            if (clicked_id_metric == prev_clicked_id_metric && prev_clicked_id_metric) {
                document.getElementById(clicked_id_metric).setAttribute("style",
                    "border: solid 2px lightgray; width:100%")

                clicked_id_metric = ""
                prev_clicked_id_metric = ""

                render_text("")
            } else {

                var count = 0

                console.log(explored_list[did].length)
                if (explored_list[did].length > 0) {
                    document.getElementById(clicked_id_metric).setAttribute("style",
                        "border: solid 2px goldenrod; width:100%")

                    if (document.getElementById(prev_clicked_id_metric))
                        document.getElementById(prev_clicked_id_metric).setAttribute("style",
                            "border: solid 2px lightgray; width:100%")

                    proposal_data = full_data[did]
                    var myNode = document.getElementById("textbox");
                    while (myNode.firstChild) {
                        myNode.removeChild(myNode.firstChild);
                    }

                    var met_comment_list = ""
                    var met_color = ""
                    var met_header = ""
                    var met_bar = ""

                    if (id == "visitback") {
                        met_comment_list = explored_list[did]
                        met_color = 'style=\"background-color: #81d4fa\"'
                        met_header = "Reviews interacted with: "
                        met_bar = "Visit - "
                    } else if (id == "distback") {
                        met_comment_list = explored_list[did]
                        met_color = 'style=\"background-color: #FFAB91\"'
                        met_header = "Sentiments in reviews interacted with: "
                        met_bar = "Distribution - "
                    } else {
                        met_comment_list = covered_list[did]
                        met_color = 'style=\"background-color: #B39DDB\"'
                        met_header = "reviews covered: "
                        met_bar = "Coverage - "
                    }

                    for (var i in met_comment_list) {

                        if (met_comment_list[i].disc == "Positive") {
                            sent = '<i class="fa fa-plus"></i>'
                        } else if (met_comment_list[i].disc == "Negative") {
                            sent = '<i class="fa fa-minus"></i>'
                        } else {
                            sent = '<i class="fa fa-circle-o"></i>'
                        }

                        console.log("metbar", topic_filter, disc_filter)

                        if (topic_filter && disc_filter) {
                            met_header = disc_filter + " reviews interacted with keyword \"" + topic_filter +
                                "\": "

                            var tokens = met_comment_list[i].text.toLowerCase().split(" ");

                            if ((met_comment_list[i].text.toLowerCase().includes(topic_filter.split(
                                        " ")[0].toLowerCase()) && met_comment_list[i].text
                                    .toLowerCase()
                                    .includes(topic_filter
                                        .split(
                                            " ")[1]
                                        .toLowerCase())) && disc_filter == met_comment_list[i].disc) {
                                count += 1

                                var divSum = document.createElement("div")
                                var divHTML =
                                    '<div style=\"margin:1px; margin-bottom: 10px; display:flex; flex-direction: row; align - items: flex - start\ ">' +
                                    '<span ' +
                                    ' style=\"padding-left:5px; padding-right:5px;' + '\">' + sent + '</span>' +
                                    "\xa0" +
                                    '<p class="commentText" id="comment_' + met_comment_list[i].id + '\"' +
                                    met_color + '>' + met_comment_list[i].text + '</p></div>'
                                divSum.innerHTML = divHTML;
                                myNode.appendChild(divSum)
                            }
                        } else if (topic_filter && !disc_filter) {
                            met_header = "reviews with keyword \"" + topic_filter + "\": "
                            var tokens = met_comment_list[i].text.toLowerCase().split(" ");
                            if ((met_comment_list[i].text.toLowerCase().includes(topic_filter.split(
                                        " ")[0].toLowerCase()) && met_comment_list[i].text
                                    .toLowerCase()
                                    .includes(topic_filter
                                        .split(
                                            " ")[1]
                                        .toLowerCase()))) {
                                count += 1

                                var divSum = document.createElement("div")
                                var divHTML =
                                    '<div style=\"margin:1px; margin-bottom: 10px; display:flex; flex-direction: row; align - items: flex - start\ ">' +
                                    '<span ' +
                                    ' style=\" padding-left:5px; padding-right:5px;' + '\">' + sent +
                                    '</span>' +
                                    "\xa0" + '<p class="commentText" id="comment_' + met_comment_list[i].id +
                                    '\"' + met_color + '>' +
                                    met_comment_list[i].text + '</p></div>'
                                divSum.innerHTML = divHTML;
                                myNode.appendChild(divSum)
                            }
                        } else if (disc_filter && !topic_filter) {
                            headertext = disc_filter + " reviews: "
                            if (disc_filter == met_comment_list[i].disc) {
                                count += 1
                                var divSum = document.createElement("div")
                                var divHTML =
                                    '<div style=\"margin:1px; margin-bottom: 10px; display:flex; flex-direction: row; align - items: flex - start\ ">' +
                                    '<span ' +
                                    ' style=\" padding-left:5px; padding-right:5px;' + '\">' + sent +
                                    '</span>' +
                                    "\xa0" + '<p class="commentText" id="comment_' + met_comment_list[i].id +
                                    '\"' + met_color + '>' +
                                    met_comment_list[i].text + '</p></div>'
                                divSum.innerHTML = divHTML;
                                myNode.appendChild(divSum)
                            }
                        } else if (!text_filter) {
                            count += 1
                            var divSum = document.createElement("div")
                            var divHTML =
                                '<div style=\"margin:1px; margin-bottom: 10px; display:flex; flex-direction: row; align - items: flex - start\ ">' +
                                '<span ' +
                                ' style=\"padding-left:5px; padding-right:5px;' + '\">' + sent + '</span>' +
                                "\xa0" +
                                '<p class="commentText" id="comment_' + met_comment_list[i].id + '\"' +
                                met_color + '>' + met_comment_list[i].text + '</p></div>'
                            divSum.innerHTML = divHTML;
                            myNode.appendChild(divSum)
                        }
                    }

                    prev_clicked_id_metric = clicked_id_metric
                    document.getElementById("commentheader").textContent = met_bar + " " + met_header + " " +
                        count.toString()
                }

                if (topic_filter) {
                    myHilitor = new Hilitor("textbox");
                    myHilitor.setMatchType("open");
                    myHilitor.apply(topic_filter);
                }
            }
        }
    })

    $("#navSearch").submit(function (e) {
        console.log("trying to sub")
        e.preventDefault();
    });

    $('#navSearch').keyup(function (e) {
        if (e.keyCode == 13) {
            render_search()
        }
    });
</script>